\startenvironment cv

\setuppapersize[letter]
\setuplayout[backspace=5.5cm, leftmargin=3cm, rightedge=0cm, width=13cm]
\setuppagenumbering[location=footer]
\setupinmargin[align=right]

\define[2]\DrawLine
{#2\inmargin{\fillinline[width=2.8cm, color={\getvariable{metadata}{maincolor}}, rulethickness=3.8pt]}}

\definehead[ResumeHead][subject]
\definehead[ResumeHeadSub][subsubject]
\setuphead[ResumeHead][style=\bfa,after={\blank[medium]}, color={\getvariable{metadata}{maincolor}}, command=\DrawLine]
\setuphead[ResumeHeadSub][style=\bf, after={\blank[medium]}, color={\getvariable{metadata}{maincolor}}]

\startluacode
require("cv")
\stopluacode

\def\ResumeEntry[#1]{\ctxlua{
        userdata.ResumeEntry('#1')}
}
\def\ResumeShortEntry[#1]{\ctxlua{
        userdata.ResumeShortEntry('#1')}
}
\def\ResumeTitle[#1]{\ctxlua{
        userdata.ResumeTitle('#1')}
}

\stopenvironment